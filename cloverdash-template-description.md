# Cloverdash Template Description

## Обзор проекта

Cloverdash - это современная платформа для разработки и развертывания веб-приложений, построенная на микросервисной архитектуре. Проект предоставляет готовый шаблон для быстрого старта разработки с предустановленными компонентами и настройками.

## Архитектура

### Микросервисная структура
- **Backend API** - основной сервис для обработки бизнес-логики
- **Telegram Bot** - интерфейс для взаимодействия с пользователями
- **Worker** - фоновые задачи и обработка очередей
- **Admin Panel** - веб-интерфейс для администраторов

### Технологический стек
- **Backend**: FastAPI, SQLAlchemy, PostgreSQL
- **Bot**: python-telegram-bot, aiogram
- **Frontend**: Streamlit для админ-панели
- **Infrastructure**: Docker, Docker Compose
- **Database**: PostgreSQL, Redis (опционально)

## Основные компоненты

### 1. Backend API (`/backend`)
Основной сервис, предоставляющий REST API для всех функций приложения.

**Ключевые модули:**
- `api/` - API endpoints и роуты
- `models/` - модели данных и ORM
- `services/` - бизнес-логика и сервисы
- `config/` - конфигурация приложения

**Основные функции:**
- Аутентификация и авторизация
- Управление пользователями
- CRUD операции для контента
- Обработка бизнес-логики

### 2. Telegram Bot (`/telegram-bot`)
Бот для Telegram, обеспечивающий пользовательский интерфейс.

**Ключевые модули:**
- `handlers/` - обработчики команд и сообщений
- `models.py` - модели данных бота
- `config.py` - конфигурация бота
- `orator_bot.py` - основная логика бота

**Основные функции:**
- Обработка команд пользователей
- Интерактивные меню и кнопки
- Интеграция с backend API
- Обработка ошибок и исключений

### 3. Worker (`/worker`)
Сервис для выполнения фоновых задач и обработки очередей.

**Основные функции:**
- Асинхронная обработка задач
- Управление очередями сообщений
- Периодические задачи
- Интеграция с базой данных

### 4. Admin Panel (`/admin_panel`)
Веб-интерфейс для администраторов системы.

**Ключевые модули:**
- `admin_app.py` - основное приложение
- `auth.py` - система аутентификации
- `database.py` - работа с базой данных
- `users_management.py` - управление пользователями
- `content_page.py` - управление контентом

**Основные функции:**
- Управление пользователями
- Модерация контента
- Просмотр статистики
- Система ролей и разрешений

## Система ролей

### super_admin
- Полный доступ ко всем функциям
- Управление системой и администраторами
- Создание и удаление пользователей

### admin
- Управление пользователями
- Модерация контента
- Просмотр статистики и отчетов

### moderator
- Модерация контента
- Просмотр пользователей
- Ограниченное управление

### user
- Базовые функции приложения
- Просмотр контента
- Выполнение действий в рамках роли

## Конфигурация

### Переменные окружения
Основные настройки приложения хранятся в файле `.env`:

```env
# Database
DB_HOST=localhost
DB_PORT=5432
DB_NAME=app_db
DB_USER=postgres
DB_PASSWORD=password

# JWT
JWT_SECRET_KEY=your-secret-key
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30

# Telegram Bot
TELEGRAM_BOT_TOKEN=your-bot-token

# Redis (опционально)
REDIS_URL=redis://localhost:6379
```

### Docker Compose
Проект включает несколько конфигураций Docker Compose:

- `docker-compose.yml` - основная конфигурация
- `docker-compose.local.yml` - для локальной разработки

## Развертывание

### Локальная разработка
1. Клонировать репозиторий
2. Создать файл `.env` с настройками
3. Запустить `docker-compose.local.yml`
4. Открыть админ-панель по адресу `http://localhost:8501`

### Продакшн
1. Настроить переменные окружения
2. Использовать `docker-compose.yml`
3. Настроить reverse proxy (nginx)
4. Настроить SSL сертификаты

## API Endpoints

### Аутентификация
- `POST /auth/login` - вход в систему
- `POST /auth/register` - регистрация
- `POST /auth/refresh` - обновление токена
- `POST /auth/logout` - выход из системы

### Пользователи
- `GET /users/profile` - профиль пользователя
- `PUT /users/profile` - обновление профиля
- `GET /users/list` - список пользователей (admin)
- `POST /users/create` - создание пользователя (admin)

### Контент
- `GET /content/exercises` - список упражнений
- `POST /content/exercises` - создание упражнения
- `PUT /content/exercises/{id}` - обновление упражнения
- `DELETE /content/exercises/{id}` - удаление упражнения

## Безопасность

### Аутентификация
- JWT токены для API
- Хеширование паролей (SHA256)
- Токены с ограниченным временем жизни

### Авторизация
- Ролевая модель доступа (RBAC)
- Проверка разрешений на уровне API
- Валидация входных данных

### Защита данных
- SQL injection protection
- XSS protection
- CSRF protection
- Rate limiting

## Мониторинг и логирование

### Логирование
- Структурированные логи в JSON формате
- Разные уровни логирования для разных компонентов
- Ротация логов

### Метрики
- Время ответа API
- Количество запросов
- Использование ресурсов
- Статистика ошибок

## Разработка

### Структура проекта
```
project/
├── backend/           # Backend API
├── telegram-bot/      # Telegram Bot
├── worker/            # Worker service
├── admin_panel/       # Admin Panel
├── deployment/        # Deployment scripts
├── docs/             # Documentation
├── tests/            # Tests
└── docker-compose.yml # Docker configuration
```

### Добавление новых функций
1. Создать модель в соответствующем модуле
2. Добавить API endpoint в backend
3. Обновить админ-панель при необходимости
4. Добавить обработчики в бота
5. Написать тесты

### Тестирование
- Unit тесты для каждого модуля
- Integration тесты для API
- E2E тесты для критических сценариев
- Автоматизированное тестирование в CI/CD

## Поддержка и документация

### Документация
- README файлы для каждого компонента
- API документация (Swagger/OpenAPI)
- Примеры использования
- Troubleshooting guide

### Поддержка
- Issues в GitHub
- Wiki с FAQ
- Примеры конфигурации
- Шаблоны для развертывания

## Лицензия

Проект распространяется под лицензией MIT. См. файл `LICENSE` для подробностей.
